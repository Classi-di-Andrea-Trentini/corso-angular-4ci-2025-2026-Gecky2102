# Lezione del 12/01/2026

## Riferimenti
- [Angular](https://angular.dev/)
- [Repository Andrea Trentini](https://github.com/andreatrentini/Corso-Angular-4Ci-2025-2026)
- [Spotify Docs](https://developer.spotify.com/documentation/web-api)
- [Sportify API Console](https://developer.spotify.com/dashboard/)

## Argomenti Trattati
- [Generare un service per le API](#generare-un-service-per-le-api)
- [Dependency Injection e HttpClient](#dependency-injection-e-httpclient)
- [Autenticazione con Spotify API](#autenticazione-con-spotify-api)

### Generare un service per le API

Per generare un service in Angular si utilizza il comando:

```bash
ng generate service nome-service
```

### Dependency Injection e HttpClient

La **Dependency Injection** è un pattern fondamentale di Angular che permette di iniettare le dipendenze necessarie alle classi senza doverle istanziare manualmente.

```typescript
httpClient: HttpClient = inject(HttpClient);
```

L'attributo `httpClient` viene inizializzato automaticamente con l'istanza della classe `HttpClient` creata all'avvio dell'applicazione. Per abilitare questo meccanismo, è necessario aggiungere il provider `provideHttpClient()` nel file `app.config.ts`.

### Autenticazione con Spotify API

Per utilizzare le API di Spotify è necessario ottenere un **token di accesso** tramite il flusso di autenticazione `client_credentials`.

#### Configurazione delle credenziali

```typescript
private clientId: string = 'c07c32d838864ab8bc6206f905f399dd';
private clientSecret: string = '45011bf050e54b4ea73cd0e92ca33b4f';
private urls: string[] = ['https://accounts.spotify.com/api/token'];
```

#### Richiesta del token

Il metodo `getToken()` effettua una richiesta POST all'endpoint di autenticazione:

1. **Header HTTP**: specifica il tipo di contenuto come `application/x-www-form-urlencoded`
2. **Body della richiesta**: contiene i parametri `grant_type`, `client_id` e `client_secret`
3. **Sottoscrizione**: il metodo `subscribe()` gestisce la risposta asincrona salvando il token ricevuto

```typescript
public getToken(): void {
    let httpHeader: HttpHeaders = new HttpHeaders()
        .set('Content-Type', 'application/x-www-form-urlencoded');

    let httpParams = new HttpParams()
        .set('grant_type', 'client_credentials')
        .set('client_id', this.clientId)
        .set('client_secret', this.clientSecret);

    this.httpClient.post<IToken>(this.urls[0], httpParams.toString(), { headers: httpHeader })
        .subscribe((token: IToken) => {
            this._token = token;
        });
}
```

Il token ottenuto viene salvato nella proprietà `_token` e sarà utilizzato per autenticare le successive richieste alle API di Spotify.